<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ghana Statistical Service Data Science Tea,">

<title>Datathon Documentation of Code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="documentation_files/libs/clipboard/clipboard.min.js"></script>
<script src="documentation_files/libs/quarto-html/quarto.js"></script>
<script src="documentation_files/libs/quarto-html/popper.min.js"></script>
<script src="documentation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="documentation_files/libs/quarto-html/anchor.min.js"></script>
<link href="documentation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="documentation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="documentation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="documentation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="documentation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Datathon Documentation of Code</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ghana Statistical Service Data Science Tea, </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>To fully understand what is happening in this notebook, it will be necessary to also view the final product, which can be found here:</p>
</section>
<section id="downloading-and-preparing-non-traditional-data-sources" class="level1">
<h1>Downloading and Preparing Non-traditional Data Sources</h1>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slippymath)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osrm)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span> (haven)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjlabelled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mlab" class="level2">
<h2 class="anchored" data-anchor-id="mlab">Mlab</h2>
<p>We used M-labs to create a proxy for the quality of internet in a give area. To access the M-lab data we use Google Big Query and used this exact query.</p>
<p><em>M-Lab, or Measurement Lab, is a consortium formed by research, industry, and public-interest partners, aiming to foster an open, verifiable ecosystem for measuring global network performance. Operating as an open source project, it draws contributions from civil society organizations, educational institutions, and private sector companies. M-Lab hosts the largest collection of open Internet performance data globally, providing publicly available internet measurement services like measurement-lab.ndt.unified_downloads to help consumers, policymakers, and researchers develop an accurate understanding of their internet service quality. Among its offerings, it provides a variety of internet measurement services, including speed testing to numerous consumer platforms and services across the web.</em></p>
<pre><code>SELECT
  client.Geo.CountryName AS name,
  client.Geo.Latitude as latitude,
  client.Geo.Longitude as longitude,
  EXTRACT(YEAR  FROM date) AS year,
  COUNT(*) AS count,
  AVG(a.MeanThroughputMbps) AS mean,
  APPROX_QUANTILES(a.MeanThroughputMbps, 100)[OFFSET(90)]  AS percentile90,
  APPROX_QUANTILES(a.MeanThroughputMbps, 100)[OFFSET(10)]  AS percentile10,
  APPROX_QUANTILES(a.MeanThroughputMbps, 100)[OFFSET(95)]  AS percentile95,
  APPROX_QUANTILES(a.MeanThroughputMbps, 100)[OFFSET(5)]   AS percentile05,
  APPROX_QUANTILES(a.MeanThroughputMbps, 100)[OFFSET(50)]  AS median,
  APPROX_QUANTILES(a.MeanThroughputMbps, 100)[OFFSET(100)]  AS max,
  APPROX_QUANTILES(a.MeanThroughputMbps, 100)[OFFSET(1)]  AS min



FROM
  `measurement-lab.ndt.unified_downloads` as ndt

WHERE
  client.Geo.CountryName = "Ghana"
  AND date BETWEEN '2018-01-01' AND '2022-12-31'
  
GROUP BY
  name,latitude, longitude,  year

ORDER BY
  name, year, mean desc</code></pre>
<p>To run this querry 3.23 TB of data is processed on Big Query (so it will take a while to run). The data was then saved as <code>data/bquxjob_6901820c_18b9489dd2e.csv</code>. now load the data into a geospatial data frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mlab_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/bquxjob_6901820c_18b9489dd2e.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(latitude, longitude   ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">c</span>(count,mean,percentile90,percentile10,percentile95,percentile05), mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>mlab_data_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mlab_data, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs=</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">&gt;</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Filter out points that are outside of Ghana by using the Ghana Shapefile. These can be downloaded from the GSS StatsBank: https://statsbank.statsghana.gov.gh/. The m-lab observations are then aggregated to a voronoi (for easier comparion with the district boundaries) and clipped to only include Ghana for nicer looking plots. The results are saved as a geopackage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>districts_ghana <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"Geo FIles/Districts_261/District_261.shp"</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>internet_speed_districts <span class="ot">&lt;-</span> mlab_data_sf <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(districts_ghana) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(count ))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>vor <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">voronoi</span>(terra<span class="sc">::</span><span class="fu">vect</span>(internet_speed_districts))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>vor_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(vor) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>ghana_shape <span class="ot">&lt;-</span> districts_ghana <span class="sc">%&gt;%</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">10</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>vor_sf_cut <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(vor_sf, Ghana_shape) </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>vor_sf_cut <span class="sc">%&gt;%</span> </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_sf</span>(<span class="st">"output_files/internet_speed_voronoi_mlab.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ookla-data" class="level2">
<h2 class="anchored" data-anchor-id="ookla-data">Ookla data</h2>
<p>Another data source we used as a proxy for internet quality comes from Ookla. Ookla data is freely available via Ookla’s Open Data Initiative. <em>Ookla Speed Test is a widely recognized web service that provides free analysis of internet access performance metrics such as connection data rate and latency. It is the flagship product of Ookl. The service is used by millions of individuals and organizations daily to measure the speed and performance of their internet connections across both fixed broadband and mobile network services. Ookla collects hundreds of millions of coverage scans daily from Android Speedtest users worldwide to determine an operator’s geographic coverage using a sample of scans received from devices on that operator’s network in each 100 m2 area.</em></p>
<p>The specicif data can be downloaded from: https://registry.opendata.aws/speedtest-global-performance/ (Global fixed broadband and mobile (cellular) network performance, allocated to zoom level 16 web mercator tiles (approximately 610.8 meters by 610.8 meters at the equator). Data is provided in both Shapefile format as well as Apache Parquet with geometries represented in Well Known Text (WKT) projected in EPSG:4326. Download speed, upload speed, and latency are collected via the Speedtest by Ookla applications for Android and iOS and averaged for each tile. Measurements are filtered to results containing GPS-quality location accuracy)</p>
<p>An example download link to download the data might be: <code>https://ookla-open-data.s3.amazonaws.com/parquet/performance/type=mobile/year=2023/quarter=2/2023-04-01_performance_mobile_tiles.parquet</code></p>
<p>19 different parquet files were downloaded and combined:</p>
<ul>
<li>[1 ]“2021-01-01_performance_fixed_tiles.parquet”</li>
<li>[2] “2021-01-01_performance_mobile_tiles.parquet”</li>
<li>[3] “2021-04-01_performance_fixed_tiles.parquet”</li>
<li>[4] “2021-04-01_performance_mobile_tiles.parquet”</li>
<li>[5] “2021-07-01_performance_fixed_tiles.parquet”</li>
<li>[6] “2021-07-01_performance_mobile_tiles.parquet”</li>
<li>[7] “2021-10-01_performance_fixed_tiles.parquet”</li>
<li>[8] “2021-10-01_performance_mobile_tiles.parquet”</li>
<li>[9] “2022-01-01_performance_fixed_tiles.parquet”</li>
<li>[10] “2022-01-01_performance_mobile_tiles.parquet”</li>
<li>[11] “2022-04-01_performance_fixed_tiles.parquet”</li>
<li>[12] “2022-04-01_performance_mobile_tiles.parquet”</li>
<li>[13] “2022-07-01_performance_fixed_tiles.parquet”</li>
<li>[14] “2022-07-01_performance_mobile_tiles.parquet”</li>
<li>[15] “2022-10-01_performance_fixed_tiles.parquet”</li>
<li>[16] “2022-10-01_performance_mobile_tiles.parquet”</li>
<li>[17] “2023-01-01_performance_fixed_tiles.parquet”</li>
<li>[18] “2023-01-01_performance_mobile_tiles.parquet”</li>
<li>[19] “2023-04-01_performance_mobile_tiles.parquet”</li>
</ul>
<p>These the files are not included in the Github, due to Github file size restrictions</p>
<p>In total there are over 10,000 test locations within Ghana. Much of this code is borrow from: https://github.com/teamookla/ookla-open-data/blob/master/tutorials/filter_parquet_bounding_box.md</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>all_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">".parquet"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>as_binary <span class="ot">=</span> <span class="cf">function</span>(x){</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">=</span> <span class="fu">rev</span>(<span class="fu">as.integer</span>(<span class="fu">intToBits</span>(x)))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">=</span> <span class="fu">seq_len</span>(<span class="fu">match</span>(<span class="dv">1</span>, tmp, <span class="fu">length</span>(tmp)) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  tmp[<span class="sc">-</span>id]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>deg2num <span class="ot">=</span> <span class="cf">function</span>(lat_deg, lon_deg, zoom) {</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  lat_rad <span class="ot">=</span> lat_deg <span class="sc">*</span> pi <span class="sc">/</span><span class="dv">180</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fl">2.0</span> <span class="sc">^</span> zoom</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  xtile <span class="ot">=</span> <span class="fu">floor</span>((lon_deg <span class="sc">+</span> <span class="fl">180.0</span>) <span class="sc">/</span> <span class="fl">360.0</span> <span class="sc">*</span> n)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  ytile <span class="ot">=</span> <span class="fu">floor</span>((<span class="fl">1.0</span> <span class="sc">-</span> <span class="fu">log</span>(<span class="fu">tan</span>(lat_rad) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="fu">cos</span>(lat_rad))) <span class="sc">/</span> pi) <span class="sc">/</span> <span class="fl">2.0</span> <span class="sc">*</span> n)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(xtile, ytile)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># reference JavaScript implementations</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># https://developer.here.com/documentation/traffic/dev_guide/common/map_tile/topics/quadkeys.html</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>tileXYToQuadKey <span class="ot">=</span> <span class="cf">function</span>(xTile, yTile, z) {</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  quadKey <span class="ot">=</span> <span class="st">""</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> z<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    digit <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    mask <span class="ot">=</span> <span class="fu">bitwShiftL</span>(<span class="dv">1</span>, i <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    xtest <span class="ot">=</span> <span class="fu">as_binary</span>(<span class="fu">bitwAnd</span>(xTile, mask))</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(xtest)) {</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>      digit <span class="ot">=</span> digit <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    ytest <span class="ot">=</span> <span class="fu">as_binary</span>(<span class="fu">bitwAnd</span>(yTile, mask))</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(ytest)) {</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>      digit <span class="ot">=</span> digit <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    quadKey <span class="ot">=</span> <span class="fu">paste0</span>(quadKey, digit)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  quadKey</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>get_perf_tiles <span class="ot">&lt;-</span> <span class="cf">function</span>(bbox, tiles){</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">st_as_sfc</span>(bbox),</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>      <span class="dv">4326</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  tile_grid <span class="ot">&lt;-</span> <span class="fu">bbox_to_tile_grid</span>(bbox, <span class="at">zoom =</span> <span class="dv">16</span>)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># zoom level 16 held constant, otherwise loop through the tile coordinates calculated above</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  quadkeys <span class="ot">&lt;-</span> <span class="fu">pmap</span>(<span class="fu">list</span>(tile_grid<span class="sc">$</span>tiles<span class="sc">$</span>x, tile_grid<span class="sc">$</span>tiles<span class="sc">$</span>y, <span class="dv">16</span>), tileXYToQuadKey)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  perf_tiles <span class="ot">&lt;-</span> tiles <span class="sc">%&gt;%</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(quadkey <span class="sc">%in%</span> quadkeys)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>ghana_shape_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(ghana_shape)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>list_parquet_files <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(all_files)){</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  parquet_file <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(all_files[i] )</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> <span class="fu">get_perf_tiles</span>(ghana_shape_bbox, parquet_file) <span class="sc">%&gt;%</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">wkt =</span> <span class="st">"tile"</span>, <span class="at">crs =</span> <span class="dv">4269</span>)</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  list_parquet_files[[i]] <span class="ot">&lt;-</span> filtered_data</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(i, <span class="st">"/"</span> , <span class="fu">length</span>(all_files)))</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a><span class="co"># sumamarise save only the  Ghana results</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>results_per_key <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(list_parquet_files) <span class="sc">%&gt;%</span> </span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(quadkey, tile,avg_d_kbps, avg_u_kbps  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(quadkey) <span class="sc">%&gt;%</span> </span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_d_kbps =</span> <span class="fu">mean</span>(avg_d_kbps),</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_u_kbps =</span> <span class="fu">mean</span>(avg_u_kbps),</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_d_kbps=</span> <span class="fu">median</span>(avg_d_kbps),</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_u_kbps=</span> <span class="fu">median</span>(avg_u_kbps),</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(results_per_key, <span class="st">"output_files/results_per_key.rds"</span>)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a><span class="co"># for the storymap we also saved the voronoi version of the ookla data</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>ookla_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="st">"output_files/results_per_key.rds"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(tile), <span class="cf">function</span>(x){<span class="fu">paste0</span>(<span class="st">"ookla_"</span>, x)}) <span class="sc">%&gt;%</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>ookla_vor <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">voronoi</span>(terra<span class="sc">::</span><span class="fu">vect</span>(ookla_results))</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(ookla_vor, <span class="st">"output_files/ookla_vor.gpkg"</span>)</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>ookla_vor <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(ookla_vor) <span class="sc">%&gt;%</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>Ghana_shape <span class="ot">&lt;-</span> ghana_shape <span class="sc">%&gt;%</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>ookla_vor <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(ookla_vor, Ghana_shape) </span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids <span class="ot">&lt;-</span> population_polygon_sf_centroids <span class="sc">%&gt;%</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(ookla_vor)</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>district_shapes <span class="ot">&lt;-</span> district_shapes <span class="sc">%&gt;%</span></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids <span class="ot">&lt;-</span> population_polygon_sf_centroids <span class="sc">%&gt;%</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(district_shapes) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="nightlight-data" class="level2">
<h2 class="anchored" data-anchor-id="nightlight-data">Nightlight data</h2>
<p>one alternative data source we used was Nightlight satellite data from the Nasa Visible Infrared Imager-Radiometer Suite (VIIRS) satellite <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. The pre-processed data for all of Sub-Saharan Africa can be downloaded here: https://github.com/giacfalk/Electrification_SSA_data and here: https://data.mendeley.com/datasets/kn4636mtvg/6/.</p>
<p>These data will later be used to compute which percentage of the popopulation lives within an area that has access to electricity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>access_levels <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data/tiersofaccess_SSA_2018.nc"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ghana_shape <span class="ot">&lt;-</span>ghana_shape <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">crs</span>(access_levels))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>access_levels_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(access_levels, ghana_shape)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>access_levels_mask <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">mask</span>(access_levels_crop,  <span class="fu">vect</span>(ghana_shape))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>access_levels_stack <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(access_levels_mask)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># view data</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#mapview::mapview(access_levels_stack$Tiers_of_access)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>access_levels_polygon <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(access_levels_mask)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>access_levels_polygon_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(access_levels_polygon)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>access_levels_polygon_sf <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_sf</span>(<span class="st">"output_files/access_levels_polygon_sf.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="access-to-school-data." class="level2">
<h2 class="anchored" data-anchor-id="access-to-school-data.">Access to School data.</h2>
<p>Although multiple sources access with the location of all school in Ghana (e.g.&nbsp;Project Connect: https://projectconnect.unicef.org/map/countries), most do not offer easy ways to download these data locally. So instead, we used OpenStreetMap<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. to download the location of all schools in Ghana (17,223 observations) and used the Open Source Routing Machine (OSRM)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> to create isodistance shapefiles (we ended up using 5km and 10km) around each school. Using OSRM has the advantage that it incorporates the road network. This way we can compute realistic travel-distances instead of just relying on straight-line distances (in cases were the roadnetwork was not sufficient we fell back on straight-line distances). To set up OSRM we first downloaded all all of the Ghana OSM data and set up a docker image running OSRM. To do this we create a new folder (to download all the files in) and ran these commands after navigating to this folder using:</p>
<pre><code>docker pull osrm/osrm-backend
wget http://download.geofabrik.de/africa/ghana-latest.osm.pbf

docker run -t -v %cd%:/data osrm/osrm-backend osrm-extract -p /opt/foot.lua /data/ghana-latest.osm.pbf
docker run -t -v %cd%:/data osrm/osrm-backend osrm-partition /data/ghana-latest.osrm
docker run -t -v %cd%:/data osrm/osrm-backend osrm-customize /data/ghana-latest.osrm
docker run -t -i -p 5000:5000 -v %cd%:/data osrm/osrm-backend osrm-routed --algorithm mld --max-table-size 10000  /data/ghana-latest.osrm</code></pre>
<p>These commands download the OSRM docker image, download the latest Ghana OSM data, and start a OSRM routing server</p>
<p>Then we downloaded all the schools locations, using the <code>osm</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the location to "Ghana"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>loc <span class="ot">&lt;-</span> <span class="st">"Ghana"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the bounding box for Ghana</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>bounding_box <span class="ot">&lt;-</span> <span class="fu">getbb</span>(loc)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the boundaries for Ghana</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>Ghana_boundries <span class="ot">&lt;-</span>bounding_box <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opq</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">'name'</span>, <span class="at">value=</span> <span class="st">"Ghana"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">osmdata_sp</span>()</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Refine the boundaries to the first multipolygon</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>Ghana_boundries <span class="ot">&lt;-</span> Ghana_boundries<span class="sc">$</span>osm_multipolygons[<span class="dv">1</span>,]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Get amenities tagged as "school" within the bounding box of Ghana</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>schools_ghana <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(Ghana_boundries) <span class="sc">%&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opq</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">'amenity'</span>, <span class="at">value =</span> <span class="fu">c</span>(<span class="st">"school"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">osmdata_sp</span>()</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract location points of these schools</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>schools_ghana_locations <span class="ot">&lt;-</span> schools_ghana<span class="sc">$</span>osm_points <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( osm_id, lon, lat )</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the school locations to an RDS file</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(schools_ghana_locations, <span class="st">"output_files/schools_ghana_locations.rds"</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a Coordinate Reference System (CRS)</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>projcrs <span class="ot">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform schools_ghana_locations to a Simple Features (SF) object and re-project</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> schools_ghana_locations <span class="sc">%&gt;%</span> </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>( <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> projcrs) <span class="sc">%&gt;%</span> </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the school data with some unspecified districts_ghana data on spatial location</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ... and calculate longitude and latitude values for each school</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>schools_in_Ghana <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(districts_ghana) <span class="sc">%&gt;%</span> </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(District)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs)  <span class="sc">%&gt;%</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lon =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>],</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>                <span class="at">lat =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up an OpenStreetMap Routing Machine (OSRM) server and profile for walking distances</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">osrm.server =</span> <span class="st">"http://localhost:5000/"</span>, <span class="at">osrm.profile =</span> <span class="st">"walk"</span>)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty tibbles to store isodistance data</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>results_500 <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>results_2000 <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>results_5000 <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>results_10000 <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through all schools, calculating isodistances and append the results</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ... to the respective tibbles</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(schools_in_Ghana)){</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({ <span class="co"># include a tryCatch to continue if there is an error</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    current_data_point <span class="ot">&lt;-</span> schools_in_Ghana <span class="sc">%&gt;%</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(i) </span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    location <span class="ot">&lt;-</span>current_data_point <span class="sc">%&gt;%</span> </span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(lon, lat) <span class="sc">%&gt;%</span> </span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>() </span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>    res_500 <span class="ot">&lt;-</span>  osrm<span class="sc">::</span><span class="fu">osrmIsodistance</span>(location, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">500</span>),</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">osrm.profile =</span> <span class="st">"foot"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">osm_id =</span> current_data_point<span class="sc">$</span>osm_id)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    res_2000 <span class="ot">&lt;-</span>  osrm<span class="sc">::</span><span class="fu">osrmIsodistance</span>(location, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2000</span>),</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">osrm.profile =</span> <span class="st">"foot"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">osm_id =</span> current_data_point<span class="sc">$</span>osm_id)</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    res_5000 <span class="ot">&lt;-</span>  osrm<span class="sc">::</span><span class="fu">osrmIsodistance</span>(location, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5000</span>),</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">osrm.profile =</span> <span class="st">"foot"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">osm_id =</span> current_data_point<span class="sc">$</span>osm_id)</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    res_10000 <span class="ot">&lt;-</span>  osrm<span class="sc">::</span><span class="fu">osrmIsodistance</span>(location, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>),</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">osrm.profile =</span> <span class="st">"foot"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">osm_id =</span> current_data_point<span class="sc">$</span>osm_id)</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(results_500) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>      results_500 <span class="ot">&lt;-</span>   res_500</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>      results_2000 <span class="ot">&lt;-</span>   res_2000</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>      results_5000 <span class="ot">&lt;-</span>   res_5000</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>      results_10000 <span class="ot">&lt;-</span> res_10000</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>      results_500 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results_500,  res_500)</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>      results_2000 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results_2000,  res_2000)</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>      results_5000 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(results_5000,  res_5000)</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>      results_10000<span class="ot">&lt;-</span> <span class="fu">rbind</span>(results_10000,  res_10000)</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error=</span><span class="cf">function</span>(e){<span class="fu">cat</span>(<span class="st">"ERROR :"</span>,<span class="fu">conditionMessage</span>(e), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)})</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify schools outside the road network by performing a spatial anti-join</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="co"># ... on the isodistance data, transform the CRS, and buffer the result</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>schools_500m_outside_roadnetwork <span class="ot">&lt;-</span> schools_in_Ghana <span class="sc">%&gt;%</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(osm_id, lon, lat) <span class="sc">%&gt;%</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(results_500, <span class="at">by =</span> <span class="fu">join_by</span>(osm_id)) <span class="sc">%&gt;%</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>( <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>          <span class="at">crs =</span> projcrs)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">500</span>)</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>schools_2000m_outside_roadnetwork <span class="ot">&lt;-</span> schools_in_Ghana <span class="sc">%&gt;%</span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(osm_id, lon, lat) <span class="sc">%&gt;%</span></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(results_2000, <span class="at">by =</span> <span class="fu">join_by</span>(osm_id)) <span class="sc">%&gt;%</span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>( <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>            <span class="at">crs =</span> projcrs)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">2000</span>)</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>schools_5k_outside_roadnetwork <span class="ot">&lt;-</span> schools_in_Ghana <span class="sc">%&gt;%</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(osm_id, lon, lat) <span class="sc">%&gt;%</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(results_5000, <span class="at">by =</span> <span class="fu">join_by</span>(osm_id)) <span class="sc">%&gt;%</span></span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>( <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>            <span class="at">crs =</span> projcrs)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">5000</span>)</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>schools_10k_outside_roadnetwork <span class="ot">&lt;-</span> schools_in_Ghana <span class="sc">%&gt;%</span></span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(osm_id, lon, lat) <span class="sc">%&gt;%</span></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(results_10000, <span class="at">by =</span> <span class="fu">join_by</span>(osm_id)) <span class="sc">%&gt;%</span></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>( <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>            <span class="at">crs =</span> projcrs)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">10000</span>)</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>walk_500m <span class="ot">&lt;-</span> results_500 <span class="sc">%&gt;%</span> </span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(schools_500m_outside_roadnetwork) <span class="sc">%&gt;%</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs)</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>filter_500 <span class="ot">&lt;-</span> </span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(schools_in_Ghana_geo, walk_500m ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enframe</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value), <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>outside_polygons_500m <span class="ot">&lt;-</span> schools_in_Ghana_geo[<span class="sc">!</span>filter_500<span class="sc">$</span>value, ] <span class="sc">%&gt;%</span> </span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">500</span>)</span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a><span class="co"># Create walkable area polygons by unioning the isodistance data with the buffered school data</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a><span class="co"># ... outside the road network, transform CRS, buffer, and union again</span></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>walk_500m_full <span class="ot">&lt;-</span>results_500 <span class="sc">%&gt;%</span> </span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(schools_500m_outside_roadnetwork)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(outside_polygons_500m) <span class="sc">%&gt;%</span> </span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs)</span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a><span class="do">######</span></span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>walk_2k <span class="ot">&lt;-</span> results_2000<span class="sc">%&gt;%</span> </span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(schools_2000m_outside_roadnetwork)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs)</span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>filter_2k <span class="ot">&lt;-</span> </span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(schools_in_Ghana_geo, walk_2k ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enframe</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value), <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>filter_2k<span class="sc">$</span>value)</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>outside_polygons_2k <span class="ot">&lt;-</span> schools_in_Ghana_geo[<span class="sc">!</span>filter_2k<span class="sc">$</span>value, ] <span class="sc">%&gt;%</span> </span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">2000</span>)</span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>walk_2k_full <span class="ot">&lt;-</span>results_2000 <span class="sc">%&gt;%</span> </span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(schools_2000m_outside_roadnetwork)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(outside_polygons_2k) <span class="sc">%&gt;%</span> </span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs)</span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a>walk_5k <span class="ot">&lt;-</span> results_5000 <span class="sc">%&gt;%</span> </span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(schools_5k_outside_roadnetwork) <span class="sc">%&gt;%</span> </span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs)</span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a>filter_5k <span class="ot">&lt;-</span> </span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(schools_in_Ghana_geo, walk_5k ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enframe</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value), <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>filter_5k<span class="sc">$</span>value)</span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a>outside_polygons_5k <span class="ot">&lt;-</span> schools_in_Ghana_geo[<span class="sc">!</span>filter_5k<span class="sc">$</span>value, ] <span class="sc">%&gt;%</span> </span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">5000</span>)</span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a>walk_5k_full <span class="ot">&lt;-</span> results_5000 <span class="sc">%&gt;%</span> </span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(schools_5k_outside_roadnetwork)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(outside_polygons_5k) <span class="sc">%&gt;%</span> </span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs)</span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a><span class="do">######</span></span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>walk_10k <span class="ot">&lt;-</span> results_10000 <span class="sc">%&gt;%</span> </span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(schools_10k_outside_roadnetwork)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs)</span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a>filter_10k <span class="ot">&lt;-</span> </span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(schools_in_Ghana_geo, walk_10k ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enframe</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(value), <span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>outside_polygons_10k <span class="ot">&lt;-</span> schools_in_Ghana_geo[<span class="sc">!</span>filter_10k<span class="sc">$</span>value, ] <span class="sc">%&gt;%</span> </span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">10000</span>)</span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>walk_10k_full <span class="ot">&lt;-</span>results_10000 <span class="sc">%&gt;%</span> </span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(schools_10k_outside_roadnetwork)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(outside_polygons_10k) <span class="sc">%&gt;%</span> </span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs)</span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a>schools_in_Ghana_geo_10k_buffer <span class="ot">&lt;-</span> schools_in_Ghana_geo <span class="sc">%&gt;%</span> </span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">10000</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs) </span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a>schools_in_Ghana_geo_5k_buffer <span class="ot">&lt;-</span> schools_in_Ghana_geo <span class="sc">%&gt;%</span> </span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">5000</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(projcrs) </span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a>schools_in_Ghana_geo <span class="ot">&lt;-</span> schools_in_Ghana <span class="sc">%&gt;%</span> </span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>( <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>),</span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a>            <span class="at">crs =</span> projcrs)</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the various geospatial datasets to GeoPackage files</span></span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(walk_500m_full, <span class="st">"output_files/walk_500m_updated.gpkg"</span>)</span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(walk_2k_full, <span class="st">"output_files/walk_2km_updated.gpkg"</span>)</span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(walk_5k_full, <span class="st">"output_files/walk_5km_updated.gpkg"</span>)</span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(walk_10k_full, <span class="st">"output_files/walk_10km_updated.gpkg"</span>)</span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(schools_in_Ghana_geo, <span class="st">"output_files/schools_in_Ghana_geo.gpkg"</span>)</span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(schools_in_Ghana_geo_5k_buffer, <span class="st">"output_files/schools_in_Ghana_geo_5k_buffer.gpkg"</span>)</span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(schools_in_Ghana_geo_10k_buffer, <span class="st">"output_files/schools_in_Ghana_geo_10k_buffer.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-from-traditional-data-sources" class="level1">
<h1>Data from Traditional data sources</h1>
<section id="population-data" class="level2">
<h2 class="anchored" data-anchor-id="population-data">Population data</h2>
<p>To get high-resolution population data (100m by 100m grid) we used WordPop’s highresolution gridded population.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. These data can be downloaded from: https://wopr.worldpop.org/?GHA/. We transform these data into centroids (assuming that within a 100m by 100m population is normally distributed) which are then used later to compute access to school, internet, and electricity. The file we create (<code>population_polygon_sf.rds</code>) cannot be uploaded to GitHub, but the file can be created with the code below (we did uploaded a zipped version, so it is possible to unzip this version)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data/GHA_population_v2_0_gridded_population.tif"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>population_crop <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">crop</span>(population, ghana_shape)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>population_mask <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">mask</span>(population_crop,  <span class="fu">vect</span>(ghana_shape))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># this takes a while as the data is big</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>population_polygon <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(population_mask, <span class="at">trunc =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>population_polygon_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(population_polygon)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>population_polygon_sf</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(population_polygon_sf, <span class="st">"output_files/population_polygon_sf.rds"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids <span class="ot">&lt;-</span> population_polygon_sf <span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="traditional-data" class="level1">
<h1>Traditional data</h1>
<p>In addition to these non-traditional data sources, we also used GSS census data. These census data come from 2 sources.</p>
<ol type="1">
<li>the Ghana Statistical Service Statsbank (https://statsbank.statsghana.gov.gh/). Some tables were directly generated on the StatsBank and downloaded.</li>
<li>The 10% micro data from the StatsBank for data sources that need dissagregation that cannot be done on the Statsbank (https://microdata.statsghana.gov.gh/). This 10% is too big to be uploaded on Github, but can be downloaded on this microdata platform.
<ol type="1">
<li>Literacy_6years_Internet.csv: this files contains some computed indicators on literacy and internet use of the population 6 years and older.</li>
<li></li>
</ol></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set path to data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>path_to_data <span class="ot">&lt;-</span>  <span class="st">"data/defactopopn_10_2021.dta"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>popict <span class="ot">&lt;-</span> sjlabelled<span class="sc">::</span><span class="fu">as_label</span>(<span class="fu">read_dta</span>(<span class="at">file =</span> path_to_data, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">col_select =</span> <span class="fu">c</span>(<span class="st">"a11d"</span>,<span class="st">"p02"</span>, <span class="st">"region"</span>, <span class="st">"distcode"</span>, <span class="st">"distcode"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"urbrur"</span>,<span class="st">"restype"</span>,<span class="st">"p11bn"</span>, <span class="st">"p19cz"</span>, <span class="st">"h08a"</span>, <span class="st">"weight"</span>, <span class="st">"p11ba"</span>, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"p11bb"</span>, <span class="st">"p11bc"</span>, <span class="st">"p11bd"</span>, <span class="st">"p11be"</span>, <span class="st">"p11bf"</span>, <span class="st">"p11bg"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"p11bh"</span>, <span class="st">"p11bi"</span>, <span class="st">"p11bj"</span>, <span class="st">"p11bk"</span>, <span class="st">"p11bl"</span>, <span class="st">"p11bm"</span>, <span class="st">"p11bbo"</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"p11bp"</span>, <span class="st">"p11bq"</span>, <span class="st">"p11br"</span>, <span class="st">"p11bs"</span>, <span class="st">"p11bt"</span>, <span class="st">"p11bu"</span>, <span class="st">"p11bv"</span>, </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"p11bw"</span>, <span class="st">"p11bx"</span> )))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">get_label</span>(popict)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Occupied housing unit"</span> , <span class="st">"Homeless household"</span> , <span class="st">"Basic Schools (KG, Primary, JHS)"</span>, </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Senior High School (SHS, Secondary)"</span>,  <span class="st">"Colleges (Nursing, etc)"</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Service training institutions (Police trg.)"</span>, </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"University/Technical University/Polytechnic/University colleges/Colleges of educ"</span> ,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Seminary/Theologian school"</span> ,  <span class="st">"Monastery/ Convent"</span>, <span class="st">"Hostel"</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Children home/ Orphanage"</span>, <span class="st">"Mining camp/ Road camp/ Farm camp"</span>, </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Prison/ Borstal/Correctional homes"</span>, <span class="st">"Leper settlements (Leprosarium)"</span>)                                                                          </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> popict <span class="sc">%&gt;%</span>  </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p02 =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(p02))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(restype <span class="sc">%in%</span> target) <span class="sc">%&gt;%</span>  </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p02<span class="sc">&gt;=</span><span class="dv">18</span>) </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pop)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="do">#### Generating Literacy in Local Languages Variable</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> pop <span class="sc">%&gt;%</span> </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Literate_Local =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    p11ba <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bb <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bc <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bd <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11be <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>      p11bf <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bg <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bh <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bi <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bj <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>      p11bk <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bl <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bm <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bbo <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bp <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>      p11bq <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11br <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bs <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bt <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bu <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> </span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>      p11bv <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bw <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> p11bx <span class="sc">==</span> <span class="st">"Yes"</span>  <span class="sc">~</span> <span class="st">"Literate"</span>, p11ba <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bb <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>      p11bc <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bd <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11be <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>      p11bf <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bg <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bh <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bi <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bj <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>      p11bk <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bl <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bm <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bbo <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bp <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>      p11bq <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11br <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bs <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bt <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bu <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> </span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>      p11bv <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bw <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> p11bx <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">~</span> <span class="st">"Illiterate"</span>,</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="do">##### Getting a cross tab of literacy in english and usage of internet####</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="do">## Getting Data for population six years and older</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>totpop <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>result_totpop <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(totpop)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_totpop) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"Totpop"</span>)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Getting Data for population who cannot read and write in English</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>toteng <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode[pop<span class="sc">$</span>p11bn <span class="sc">==</span> <span class="st">"No"</span>])</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>result_eng <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(toteng)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_eng) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"Illiterate"</span>)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="do">## Getting Data for population who did not use internet</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>totint <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode[pop<span class="sc">$</span>p19cz <span class="sc">==</span> <span class="st">"Yes"</span>])</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>result_ent <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(totint)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_ent) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"Internet"</span>)</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="do">### Getting data for Illiterate and Access to internet</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>cross_tab <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode[pop<span class="sc">$</span>p11bn <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> pop<span class="sc">$</span>p19cz <span class="sc">==</span> <span class="st">"No"</span>])</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>result_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cross_tab)</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"Illit_Inte"</span>)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="do">### Getting data for Illiterate and No Access to internet</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>cross_tab1 <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode[pop<span class="sc">$</span>p11bn <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> pop<span class="sc">$</span>p19cz <span class="sc">==</span> <span class="st">"Yes"</span>])</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>result_ill_noint <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cross_tab1)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_ill_noint) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"Illit_noInte"</span>)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="do">### Getting data for literate and No Access to internet</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>cross_tab2 <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode[pop<span class="sc">$</span>p11bn <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> pop<span class="sc">$</span>p19cz <span class="sc">==</span> <span class="st">"Yes"</span>])</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>result_lit_noint <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cross_tab2)</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_lit_noint) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"lit_noInte"</span>)</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>cross_tab3 <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode[pop<span class="sc">$</span>p11bn <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> pop<span class="sc">$</span>p19cz <span class="sc">==</span> <span class="st">"No"</span>])</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>result_lit_int <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cross_tab3)</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_lit_int) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"lit_Inte"</span>)</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>cross_tab4 <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode[pop<span class="sc">$</span>p11bn <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> pop<span class="sc">$</span>Literate_Local <span class="sc">==</span> <span class="st">"Literate"</span>])</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>result_Illit_Eng_Literate_Local <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cross_tab4)</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_Illit_Eng_Literate_Local) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"Illit_Eng_Literate_Local"</span>)</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>cross_tab5 <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode[pop<span class="sc">$</span>p19cz <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> pop<span class="sc">$</span>Literate_Local <span class="sc">==</span> <span class="st">"Literate"</span>])</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>result_Literate_Local_Use_Int <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cross_tab5)</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_Literate_Local_Use_Int) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"Literate_Local_Used_Int"</span>)</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>cross_tab6 <span class="ot">&lt;-</span> <span class="fu">table</span>(pop<span class="sc">$</span>distcode[pop<span class="sc">$</span>p19cz <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> pop<span class="sc">$</span>Literate_Local <span class="sc">==</span> <span class="st">"Literate"</span>])</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>result_Literate_Local_Not_Int <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cross_tab6)</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result_Literate_Local_Not_Int) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"District"</span>, <span class="st">"Literate_Local_Not_Used_Int"</span>)</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="do">### Creating the data frame for all objects</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">distcode =</span> result_totpop<span class="sc">$</span>District, result_totpop<span class="sc">$</span>Totpop, result_eng<span class="sc">$</span>Illiterate, result_ent<span class="sc">$</span>Internet,</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>                 result_df<span class="sc">$</span>Illit_Inte, result_ill_noint<span class="sc">$</span>Illit_noInte, result_lit_noint<span class="sc">$</span>lit_noInte, result_lit_int<span class="sc">$</span>lit_Inte,</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>                 result_Illit_Eng_Literate_Local<span class="sc">$</span>Illit_Eng_Literate_Local, result_Literate_Local_Use_Int<span class="sc">$</span>Literate_Local_Used_Int,</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>                 result_Literate_Local_Not_Int<span class="sc">$</span>Literate_Local_Not_Used_Int)</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(New_final)</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>Final <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_English_Illiterate=</span>result_eng_illiterate<span class="sc">/</span>result_totpop_totpop,</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_Did_Not_Used_Internet=</span>result_ent_internet<span class="sc">/</span>result_totpop_totpop,</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_Illiterate_Internet=</span>result_df_illit_inte<span class="sc">/</span>result_totpop_totpop,</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_Illiterate_NoInternet=</span>result_ill_noint_illit_no_inte<span class="sc">/</span>result_totpop_totpop,</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_Literate_Nointernet=</span>result_lit_noint_lit_no_inte<span class="sc">/</span>result_totpop_totpop,</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_Literate_Internet=</span>result_lit_int_lit_inte<span class="sc">/</span>result_totpop_totpop,</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_Illit_Eng_Literate_Local=</span>result_illit_eng_literate_local_illit_eng_literate_local<span class="sc">/</span>result_totpop_totpop,</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_lit_local_Usedict=</span>result_literate_local_use_int_literate_local_used_int<span class="sc">/</span>result_totpop_totpop,</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_lit_local_Not_Usedict=</span>result_literate_local_not_int_literate_local_not_used_int<span class="sc">/</span>result_totpop_totpop,</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="st">"output_files/Literacy_6years_Internet.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compute-final-index" class="level1">
<h1>compute final index</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load literacy data from a CSV file and clean column names using the janitor package.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, select the column 'district_name' and any columns containing the string "prop_"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>literacy_data <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="st">"output_files/Literacy_6years_Internet.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(district_name,<span class="fu">contains</span>(<span class="st">"prop_"</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load electricity data from the statsbank Select, rename, and mutate columns to prepare data for analysis.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Correct any misspelling in the Geographic_Area column</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>electrcity_data <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"https://statsbank.statsghana.gov.gh:443/sq/03fc2423-d895-4bc9-9696-eb5a71a3fc22"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geographic_Area, electric) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">electric_census_use =</span> electric)<span class="sc">%&gt;%</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Geographic_Area  =</span> <span class="fu">ifelse</span>(Geographic_Area  <span class="sc">==</span><span class="st">"Cape Cape Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Cape Coast Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                            Geographic_Area ))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and process internet usage data</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>internet_use <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"data/ICT21_20231104-211447.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion_used_internet_census =</span> No<span class="sc">/</span>Total) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geographic_Area    , proportion_used_internet_census )<span class="sc">%&gt;%</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Geographic_Area  =</span> <span class="fu">ifelse</span>(Geographic_Area  <span class="sc">==</span><span class="st">"Cape Cape Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Cape Coast Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                            Geographic_Area ))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and process smartphone ownership data</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>smartphone_ownership<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/ICT1_20231105-075121.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion_owns_smartphone =</span> Yes<span class="sc">/</span>Total) <span class="sc">%&gt;%</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geographic_Area    , proportion_owns_smartphone )<span class="sc">%&gt;%</span> </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Geographic_Area  =</span> <span class="fu">ifelse</span>(Geographic_Area  <span class="sc">==</span><span class="st">"Cape Cape Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Cape Coast Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>                                   Geographic_Area ))</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and process laptop ownership data</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>laptop_ownership <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/ICT4_20231105-081915.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion_owns_laptop =</span> Yes<span class="sc">/</span>Total) <span class="sc">%&gt;%</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geographic_Area    , proportion_owns_laptop )<span class="sc">%&gt;%</span> </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Geographic_Area  =</span> <span class="fu">ifelse</span>(Geographic_Area  <span class="sc">==</span><span class="st">"Cape Cape Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Cape Coast Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>                                   Geographic_Area ))</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and process enrollment data</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>enrollment_data <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data/Enrollment_Datathon.xlsx"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">percentage_3_14_years_currently_enrolled =</span> Proportion) <span class="sc">%&gt;%</span> </span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">District  =</span> <span class="fu">ifelse</span>(District  <span class="sc">==</span><span class="st">"Cape Cape Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"Cape Coast Metropolitan Area (CCMA)"</span>, </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>                            District ))</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Load polygon data representing population distribution and calculate centroids of each polygon.</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>population_polygon_sf<span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="st">"output_files/population_polygon_sf.rds"</span>)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids <span class="ot">&lt;-</span> population_polygon_sf <span class="sc">%&gt;%</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Load geographical data on school access within 10km and transform coordinates to a common CRS (Coordinate Reference System).</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>School_10k_access <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"output_files/walk_10km_updated.gpkg"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() </span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine intersections between population centroids and 10km school access areas.</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>population_within_10Kschool <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(population_polygon_sf_centroids, School_10k_access)</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids<span class="sc">$</span>within_school_10k <span class="ot">=</span> <span class="fu">as.numeric</span>(population_within_10Kschool)</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Process the intersection data to fill missing values with zeros and ensure validity.</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids<span class="ot">&lt;-</span> population_polygon_sf_centroids <span class="sc">%&gt;%</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">within_school_10k =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(within_school_10k ), <span class="dv">0</span>, <span class="dv">1</span>)) </span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>School_5k_access <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"output_files/walk_5km_updated.gpkg"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() </span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>population_within_5Kschool <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(population_polygon_sf_centroids, School_5k_access)</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids<span class="sc">$</span>within_school_5k <span class="ot">=</span> <span class="fu">as.numeric</span>(population_within_5Kschool)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids<span class="ot">&lt;-</span> population_polygon_sf_centroids <span class="sc">%&gt;%</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">within_school_5k=</span> <span class="fu">replace_na</span>(within_school_5k, <span class="dv">0</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># just to be sure</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">within_school_10k  =</span> <span class="fu">ifelse</span>(within_school_5k <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>,  within_school_10k))</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>elec_access_shape <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"output_files/access_levels_polygon_sf.gpkg"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Tiers_of_access <span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>population_with_elec <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(population_polygon_sf_centroids, elec_access_shape)</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids<span class="sc">$</span>elec_access <span class="ot">=</span> <span class="fu">as.numeric</span>(population_with_elec)</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids<span class="ot">&lt;-</span> population_polygon_sf_centroids <span class="sc">%&gt;%</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">elec_access=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(elec_access), <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>mlab_voronoi <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"output_files/internet_speed_voronoi_mlab.gpkg"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Label, <span class="sc">-</span>District, <span class="sc">-</span>Region) <span class="sc">%&gt;%</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(geom), <span class="cf">function</span>(x){<span class="fu">paste0</span>(<span class="st">"mlab_"</span>, x)}) </span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids <span class="ot">&lt;-</span>population_polygon_sf_centroids <span class="sc">%&gt;%</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(mlab_voronoi)</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>ookla_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="st">"output_files/results_per_key.rds"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(tile), <span class="cf">function</span>(x){<span class="fu">paste0</span>(<span class="st">"ookla_"</span>, x)}) <span class="sc">%&gt;%</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>ookla_vor <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">voronoi</span>(terra<span class="sc">::</span><span class="fu">vect</span>(ookla_results))</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>ookla_vor <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(ookla_vor) <span class="sc">%&gt;%</span></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>ookla_vor <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(ookla_vor,ghana_shape)</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids <span class="ot">&lt;-</span> population_polygon_sf_centroids <span class="sc">%&gt;%</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(ookla_vor)</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>district_shapes <span class="ot">&lt;-</span> districts_ghana <span class="sc">%&gt;%</span></span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32630</span>)</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>population_polygon_sf_centroids <span class="ot">&lt;-</span> population_polygon_sf_centroids <span class="sc">%&gt;%</span></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(district_shapes) </span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>all_data_district_levels <span class="ot">&lt;-</span> population_polygon_sf_centroids<span class="sc">%&gt;%</span></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(District)) <span class="sc">%&gt;%</span></span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(District) <span class="sc">%&gt;%</span></span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">within_school_10k_n =</span> <span class="fu">sum</span>(within_school_10k  <span class="sc">*</span> GHA_population_v2_0_gridded_population, <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>            <span class="at">within_school_5k_n =</span> <span class="fu">sum</span>(within_school_5k  <span class="sc">*</span> GHA_population_v2_0_gridded_population, <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_pop =</span>  <span class="fu">sum</span>(GHA_population_v2_0_gridded_population,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>            <span class="at">with_elec_access =</span> <span class="fu">sum</span>(elec_access   <span class="sc">*</span> GHA_population_v2_0_gridded_population,  <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_mlab_mean =</span> <span class="fu">mean</span>(mlab_mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>            <span class="at">weighted_mean_mlab_mean =</span> <span class="fu">weighted.mean</span>(mlab_mean, GHA_population_v2_0_gridded_population,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>  ),</span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_mlab_percentile90      =</span> <span class="fu">mean</span>(mlab_percentile90, <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>            <span class="at">weighted_mlab_percentile90  =</span> <span class="fu">weighted.mean</span>(mlab_percentile90, GHA_population_v2_0_gridded_population,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>  ),</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_mlab_mlab_percentile10 =</span> <span class="fu">mean</span>(mlab_percentile10,  <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>            <span class="at">weighted_mlab_percentile10  =</span> <span class="fu">weighted.mean</span>(mlab_percentile10, GHA_population_v2_0_gridded_population,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>  ),</span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_ookla_median_d_kbps =</span> <span class="fu">mean</span>(ookla_median_d_kbps,  <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>            <span class="at">weighted_ookla_median_d_kbps  =</span> <span class="fu">weighted.mean</span>(ookla_median_d_kbps, GHA_population_v2_0_gridded_population,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>  ),</span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_ookla_mean_d_kbps=</span> <span class="fu">mean</span>(ookla_mean_d_kbps,  <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>            <span class="at">weighted_ookla_mean_d_kbps  =</span> <span class="fu">weighted.mean</span>(ookla_mean_d_kbps, GHA_population_v2_0_gridded_population,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>  ),</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_ookla_median_u_kbpss=</span> <span class="fu">mean</span>(ookla_median_u_kbps,  <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>            <span class="at">weighted_ookla_median_u_kbps =</span> <span class="fu">weighted.mean</span>(ookla_median_u_kbps, GHA_population_v2_0_gridded_population,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>  ),</span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_ookla_mean_u_kbps=</span> <span class="fu">mean</span>(ookla_mean_u_kbps,  <span class="at">na.rm =</span> <span class="cn">TRUE</span> ),</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>            <span class="at">weighted_ookla_mean_u_kbps  =</span> <span class="fu">weighted.mean</span>(ookla_mean_u_kbps, GHA_population_v2_0_gridded_population,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>  )</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion_within_school_10k_n =</span> within_school_10k_n<span class="sc">/</span>total_pop )<span class="sc">%&gt;%</span></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion_within_school_5k_n =</span> within_school_5k_n<span class="sc">/</span>total_pop )<span class="sc">%&gt;%</span></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion_with_elec_access  =</span> with_elec_access<span class="sc">/</span>total_pop ) <span class="sc">%&gt;%</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(literacy_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"District"</span> <span class="ot">=</span> <span class="st">"district_name"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(internet_use, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"District"</span> <span class="ot">=</span> <span class="st">"Geographic_Area"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(enrollment_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"District"</span> <span class="ot">=</span> <span class="st">"District"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(electrcity_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"District"</span> <span class="ot">=</span> <span class="st">"Geographic_Area"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(laptop_ownership, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"District"</span> <span class="ot">=</span> <span class="st">"Geographic_Area"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(smartphone_ownership, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"District"</span> <span class="ot">=</span> <span class="st">"Geographic_Area"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>all_data_district_levels_sf <span class="ot">&lt;-</span> district_shapes <span class="sc">%&gt;%</span></span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(all_data_district_levels)</span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(all_data_district_levels_sf, <span class="st">"output_files/all_data_district_levels.gpkg"</span>)</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>all_data_district_levels_df <span class="ot">&lt;-</span>all_data_district_levels <span class="sc">%&gt;%</span></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(all_data_district_levels_df, <span class="st">"output_files/all_data_district_levels_df.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="creating-the-ranks" class="level2">
<h2 class="anchored" data-anchor-id="creating-the-ranks">creating the ranks</h2>
<p>after preparing all the code we can rank them by our define code (other people might have different ideas)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>score_within_10 <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>score_within_5 <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>score_enrollment <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>score_electricity_nightlight <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>score_electricty_census <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>rank_multiplier_ookla <span class="ot">=</span> <span class="dv">100</span><span class="sc">/</span><span class="dv">261</span><span class="sc">/</span><span class="dv">5</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>rank_multiplier_mlab<span class="ot">=</span> <span class="dv">100</span><span class="sc">/</span><span class="dv">261</span><span class="sc">/</span><span class="dv">5</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>score_used_internet <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>score_own_laptop <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>score_own_smartphone <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>ranks <span class="ot">&lt;-</span> all_data_district_levels_df <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ookla_rank =</span> <span class="fu">rank</span>(weighted_ookla_median_d_kbps),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">mlab_rank =</span> <span class="fu">rank</span>(weighted_mean_mlab_mean)) <span class="sc">%&gt;%</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score_education =</span> proportion_within_school_10k_n <span class="sc">*</span> score_within_10 <span class="sc">+</span> </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                           proportion_within_school_5k_n <span class="sc">*</span> score_within_5 <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                            (percentage_3_14_years_currently_enrolled<span class="sc">/</span><span class="dv">100</span>) <span class="sc">*</span> score_enrollment,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">score_electricity =</span> proportion_with_elec_access <span class="sc">*</span> score_electricity_nightlight <span class="sc">+</span> </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                            (electric_census_use<span class="sc">/</span><span class="dv">100</span>) <span class="sc">*</span> score_electricty_census,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">score_internet =</span> ookla_rank <span class="sc">*</span> rank_multiplier_ookla <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                          mlab_rank <span class="sc">*</span> rank_multiplier_mlab <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>           proportion_owns_laptop <span class="sc">*</span>  score_own_laptop <span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>           proportion_owns_smartphone <span class="sc">*</span> score_own_smartphone <span class="sc">+</span> </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                          (proportion_used_internet_census) <span class="sc">*</span> score_used_internet</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score_final =</span> (score_education <span class="sc">+</span> score_electricity <span class="sc">+</span> score_internet)) <span class="sc">%&gt;%</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score_final_deflated =</span> score_final<span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>prop_illit_eng_literate_local)) <span class="sc">%&gt;%</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(District, score_education, score_electricity, score_internet, score_final, score_final_deflated, prop_illit_eng_literate_local) <span class="sc">%&gt;%</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank_score =</span> <span class="fu">rank</span>(score_final_deflated)) <span class="sc">%&gt;%</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rank_score))</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(ranks, <span class="st">"output_files/ranks.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="shiny-app-for-aai" class="level1">
<h1>Shiny App for AAI</h1>
<p>This was used to create data needed for the R shiny app with the AII. The code for the app itself sits in the folder Shiny_AII_app. we also created a simplified version of the district shapefiles on mapshaper.org</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data_for_app <span class="ot">&lt;-</span> all_data_district_levels_df <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ookla_rank =</span> <span class="fu">rank</span>(weighted_ookla_median_d_kbps),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">mlab_rank =</span> <span class="fu">rank</span>(weighted_mean_mlab_mean))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(data_for_app, <span class="st">"Shiny_AII_app/data_for_app.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="computing-sdg-indicators-from-census-data." class="level2">
<h2 class="anchored" data-anchor-id="computing-sdg-indicators-from-census-data.">Computing SDG indicators from Census Data.</h2>
<p>This is the R code for the computation of SDG indicators at the District levels using the census data (both from the StatBank and the 10% sample data). The merging of these files was done in Excel, and the final output file is called <code>SDG indicator tracker new - 05-11-2023 updated.csv</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this file (10% sample) you will have to download from the micro data platform</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> sjlabelled<span class="sc">::</span><span class="fu">as_label</span>(<span class="fu">read_dta</span>(<span class="st">"data/defactopopn_10%_2021.dta"</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>target1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Occupied housing unit"</span> , <span class="st">"Homeless household"</span> , <span class="st">"Basic Schools (KG, Primary, JHS)"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Senior High School (SHS, Secondary)"</span>,  <span class="st">"Colleges (Nursing, etc)"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Service training institutions (Police trg.)"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"University/Technical University/Polytechnic/University colleges/Colleges of educ"</span> ,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Seminary/Theologian school"</span> ,  <span class="st">"Monastery/ Convent"</span>, <span class="st">"Hostel"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Children home/ Orphanage"</span>, <span class="st">"Mining camp/ Road camp/ Farm camp"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Prison/ Borstal/Correctional homes"</span>, <span class="st">"Leper settlements (Leprosarium)"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicator 3.7.2:  Adolescent birth rate (aged 12–14 years) per 1,000 women in that age group  </span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>adolescent_birth_rate_12_14 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtering the data to contain only females aged 12 to 14 and lives </span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in households and residential structures</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(a11d <span class="sc">==</span> <span class="st">"Female"</span> <span class="sc">&amp;</span> <span class="fu">between</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(p02)), <span class="dv">12</span>, <span class="dv">14</span>) <span class="sc">&amp;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>           restype <span class="sc">%in%</span> target1) <span class="sc">%&gt;%</span> </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Giving the value one to persons who has ever born at least one child</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">num1 =</span> <span class="fu">ifelse</span>(p20t <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Giving the value one all persons who has ever born at least one child</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">den1 =</span> <span class="dv">1</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weighting the `num1` and `den1` variables</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">num =</span> <span class="fu">round</span>(weight <span class="sc">*</span> num1, <span class="dv">0</span>),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">den =</span> <span class="fu">round</span>(weight <span class="sc">*</span> den1, <span class="dv">0</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(distcode) <span class="sc">%&gt;%</span> </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the total number of females who have ever born at least one child per district</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">numerator =</span> <span class="fu">sum</span>(num, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the total number of females per district</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">denominator =</span> <span class="fu">sum</span>(den, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the proportion of females who have ever born per district</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">adolescent_birth_rate_12_14 =</span> <span class="dv">1000</span> <span class="sc">*</span> numerator <span class="sc">/</span> denominator</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(distcode, adolescent_birth_rate_12_14)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(adolescent_birth_rate_12_14, <span class="st">"output_files/adol birth rate (12-14).csv"</span>)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicator 3.7.2: Adolescent birth rate (aged 15-19 years) per 1,000 women in that age group  </span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>adolescent_birth_rate_15_19 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtering the data to contain females aged 15 to 19 and lives </span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in households and residential structures</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(a11d <span class="sc">==</span> <span class="st">"Female"</span> <span class="sc">&amp;</span> <span class="fu">between</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(p02)), <span class="dv">15</span>, <span class="dv">19</span>) <span class="sc">&amp;</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>           restype <span class="sc">%in%</span> target1) <span class="sc">%&gt;%</span> </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Giving the value one to persons who has ever born at least one child</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">num1 =</span> <span class="fu">ifelse</span>(p20t <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Giving the value one all persons who has ever born at least one child</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">den1 =</span> <span class="dv">1</span>,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weighting the `num1` and `den1` variables</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">num =</span> <span class="fu">round</span>(weight <span class="sc">*</span> num1, <span class="dv">0</span>),</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">den =</span> <span class="fu">round</span>(weight <span class="sc">*</span> den1, <span class="dv">0</span>)</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(distcode) <span class="sc">%&gt;%</span> </span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the total number of females who have ever born at least one child per district</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">numerator =</span> <span class="fu">sum</span>(num, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the total number of females per district</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">denominator =</span> <span class="fu">sum</span>(den, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the proportion of females who have ever born per district</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">adolescent_birth_rate_15_19 =</span> <span class="dv">1000</span> <span class="sc">*</span> numerator <span class="sc">/</span> denominator</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(distcode, adolescent_birth_rate_15_19)</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(adolescent_birth_rate_15_19, <span class="st">"output_files/adol birth rate (15-19).csv"</span>)</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicator 8.5.2: Unemployment rate, by sex, age and persons with disabilities (15years and older)</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>unemployment_rate_disable <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtering the data to contain only persons with difficulty in performing activity</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(p02))<span class="sc">&gt;=</span><span class="dv">15</span> <span class="sc">&amp;</span> (p18a <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Yes, some difficulty"</span>, <span class="st">"Yes, a lot of difficulty"</span>, <span class="st">"Cannot see at all"</span>) <span class="sc">|</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>            p18b <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Yes, some difficulty"</span>, <span class="st">"Yes, a lot of difficulty"</span>, <span class="st">"Cannot see at all"</span>) <span class="sc">|</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>            p18c <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Yes, some difficulty"</span>, <span class="st">"Yes, a lot of difficulty"</span>, <span class="st">"Cannot see at all"</span>) <span class="sc">|</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>            p18d <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Yes, some difficulty"</span>, <span class="st">"Yes, a lot of difficulty"</span>, <span class="st">"Cannot see at all"</span>) <span class="sc">|</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>            p18e <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Yes, some difficulty"</span>, <span class="st">"Yes, a lot of difficulty"</span>, <span class="st">"Cannot see at all"</span>) <span class="sc">|</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>            p18f <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Yes, some difficulty"</span>, <span class="st">"Yes, a lot of difficulty"</span>, <span class="st">"Cannot see at all"</span>)) <span class="sc">&amp;</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>           restype <span class="sc">%in%</span> target1) <span class="sc">%&gt;%</span> </span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Giving the value one to persons who are unemployed</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">num1 =</span> <span class="fu">ifelse</span>(econact <span class="sc">==</span> <span class="st">"Unemployed"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Giving the value one to each person</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">den1 =</span> <span class="dv">1</span>,</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weighting the `num1` and `den1` variables</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">num =</span> <span class="fu">round</span>(weight <span class="sc">*</span> num1, <span class="dv">0</span>),</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">den =</span> <span class="fu">round</span>(weight <span class="sc">*</span> den1, <span class="dv">0</span>)</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(distcode) <span class="sc">%&gt;%</span> </span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the total number of persons with disability who are unemployed per district</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">numerator =</span> <span class="fu">sum</span>(num, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the total number  persons with disability per district</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">denominator =</span> <span class="fu">sum</span>(den, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the proportion of persons with disability who are unemployed</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">unemployed_disabled =</span> <span class="dv">100</span> <span class="sc">*</span> numerator <span class="sc">/</span> denominator</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(distcode, unemployed_disabled)</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(unemployment_rate_disable, <span class="st">"output_files/unemployment_rate_disable.csv"</span>)</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicator 6.2.1 Proportion of population using (a) safely managed sanitation services</span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>safely_managed_sanitation <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filtering the data to contain only occupied housing units</span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(restype <span class="sc">==</span> <span class="st">"Occupied housing unit"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Giving the value one to persons who lives households with safely managed sanitation services</span></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">num1 =</span> <span class="fu">ifelse</span>(s03 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Septic tank (manhole)"</span>, <span class="st">"KVIP/VIP"</span>, <span class="st">"Pit latrine"</span>,</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Enviro Loo"</span>, <span class="st">"Bio-digester (e.g. bio fill)"</span>, </span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Bio gas"</span>, <span class="st">"Portable toilet (e.g. Water potti)"</span>,</span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"Sewer"</span>) <span class="sc">&amp;</span> </span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>                    s04 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"WC seat"</span>, <span class="st">"Flush squat bowl"</span>, <span class="st">"Pour flush bowl"</span>,</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Urine-diverting dry toilet (UDDT)"</span>, </span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Concrete pedestal/slab"</span>, <span class="st">"Wooden pedestal/slab"</span>,</span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>                               <span class="st">" Satopan/Micro flush"</span>), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Giving the value one all persons who lives in households</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">den1 =</span> <span class="dv">1</span>,</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weighting the `num1` and `den1` variables</span></span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">num =</span> <span class="fu">round</span>(weight <span class="sc">*</span> num1, <span class="dv">0</span>),</span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">den =</span> <span class="fu">round</span>(weight <span class="sc">*</span> den1, <span class="dv">0</span>)</span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(distcode) <span class="sc">%&gt;%</span> </span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the total number of persons who live in households with safely managed sanitation services</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">numerator =</span> <span class="fu">sum</span>(num, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the total number of females per district</span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">denominator =</span> <span class="fu">sum</span>(den, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Computing the proportion of females who have ever born per district</span></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">unemployed_disabled =</span> <span class="dv">100</span> <span class="sc">*</span> numerator <span class="sc">/</span> denominator</span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(distcode, unemployed_disabled)</span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(safely_managed_sanitation, <span class="st">"output_files/safely_managed_sanitation.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>census_SDG_indicators <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"output_files/SDG indicator tracker new - 05-11-2023 updated.csv"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>district_shapes_with_SDG_indicators <span class="ot">&lt;-</span> district_shapes <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(census_SDG_indicators, <span class="fu">join_by</span>(District))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(district_shapes_with_SDG_indicators, <span class="st">"output_files/district_shapes_with_SDG_indicators.gpkg"</span> ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tools" class="level2">
<h2 class="anchored" data-anchor-id="tools">Tools</h2>
<ul>
<li>R</li>
<li>shiny</li>
<li>Midjourney v5: used to make some of the visuals for the storymap</li>
<li>Google Big Query</li>
<li>Excel: some on the fly</li>
<li>ArcGIS: used for mapping and StoryBoard</li>
<li>AWS: for hosting of shiny app and running of heavy analyses</li>
</ul>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Falchetta, G., Pachauri, S., Parkinson, S. et al.&nbsp;A high-resolution gridded dataset to assess electrification in sub-Saharan Africa. Sci Data 6, 110 (2019). https://doi.org/10.1038/s41597-019-0122-6<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://www.openstreetmap.org/<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>https://project-osrm.org/<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>https://data.worldpop.org/repo/wopr/GHA/population/v2.0/GHA_population_v2_0_README.pdf<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>